---
# tasks file for utils (install common CLI utilities) â€” macOS only

- name: Skip if role already executed
  meta: end_role
  when: vars[role_execution_flag] | default(false)

- name: Determine allowed platform for utils setup (macOS MacBook only)
  set_fact:
    utils_macos_allowed: >-
      {{ (ansible_facts['os_family'] | default('')) == 'Darwin' and (device_type | default('')) == 'macbook' }}

- name: Stop role when not on a supported platform (macOS MacBook)
  meta: end_role
  when: not (utils_macos_allowed | bool)

- block:
    - name: Ensure utilities are installed via Homebrew (macOS)
      community.general.homebrew:
        name:
          - bpytop
          - glances
          - nmap
          - curl
          - wget
          - speedtest-cli
          - ncdu
          - jq
          - coreutils
          - appcleaner
          - ffmpeg
          - the-unarchiver
        state: present
      become: false
  when: utils_macos_allowed | bool

- name: Mark role as executed
  set_fact:
    "{{ role_execution_flag }}": true
    cacheable: true
