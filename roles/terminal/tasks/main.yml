---
# tasks file for terminal (install iTerm2 on macOS; no-op on Arch Linux)

- name: Skip if role already executed
  meta: end_role
  when: vars[role_execution_flag] | default(false)

- name: Determine allowed platforms for terminal setup (macOS MacBook or Arch Linux)
  set_fact:
    terminal_macos_allowed: >-
      {{ (ansible_facts['os_family'] | default('')) == 'Darwin' and (device_type | default('')) == 'macbook' }}
    terminal_arch_allowed: >-
      {{ (ansible_facts['os_family'] | default('')) == 'Archlinux' or
         (ansible_facts['distribution'] | default('')) == 'Archlinux' or
         (distro | default('')) == 'archlinux' }}

- name: Stop role when not on a supported platform (macOS MacBook or Arch Linux)
  meta: end_role
  when: not (terminal_macos_allowed | bool or terminal_arch_allowed | bool)

- block:
    - name: Ensure iTerm2 is present via Homebrew Cask (macOS)
      community.general.homebrew_cask:
        name: iterm2
        state: present
      become: false
  when: terminal_macos_allowed | bool

- block:
    - name: No terminal packages to install on Arch Linux (noop)
      ansible.builtin.debug:
        msg: "terminal role: nothing to do on Arch Linux."
  when: terminal_arch_allowed | bool

- name: Mark role as executed
  set_fact:
    "{{ role_execution_flag }}": true
    cacheable: true
